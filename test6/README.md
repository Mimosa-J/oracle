# 实验6：基于Oracle的订单管理数据库设计

姓名：雷勇杰																																学号：201810414414

## 期末考核要求

- 自行设计一个信息系统的数据库项目，自拟`某项目`名称。
- 设计项目涉及的表及表空间使用方案。至少5张表和5万条数据，两个表空间。
- 设计权限及用户分配方案。至少两类角色，两个用户。
- 在数据库中建立一个程序包，在包中用PL/SQL语言设计一些存储过程和函数，实现比较复杂的业务逻辑，用模拟数据进行执行计划分析。
- 设计自动备份方案或则手工备份方案。
- 设计容灾方案。使用两台主机，通过DataGuard实现数据库整体的异地备份(可选)。

## 实验步骤

1. 以system登录到pdborcl，创建角色role_1和用户user_1，并授权和分配空间

   ![/图片1](./1.png)

2. 以system登录到pdborcl，创建角色role_2和用户user_2，并授权和分配空间

   ![/图片2](./2.png)

3. 创建表1DEPARTMENTS

   ![/图片3](./3.png)

4. 创建表2EMPLOYEES

   ![/图片4](./4.png)

5. 创建表3PRODUCTS

   ![/图片5](./5.png)

6. 创建表4ORDERS

   ![/图片6](./6.png)

7. 创建表5ORDER_ID_TEMP

   ![/图片7](./7.png)

8. 创建表6ORDER_DETAILS

   ![/图片8](./8.png)

9. 插入数据，共五次

   ![/图片9](./9.png)

10. 查询数据量

    ![/图片10](./10.png)

11. 在数据库中建立一个程序包，在包中用PL/SQL语言设计一些存储过程和函数，实现比较复杂的业务逻辑，用模拟数据进行执行计划分析。

    ![/图片11](./11.png)

    ![/图片12](./12.png)

12. 用模拟数据进行执行计划分析。

    ![/图片13](./13.png)

13. 开始全备份

    ![/图片14](./14.png)

14. 查看备份文件内容

    ![/图片15](./15.png)

15. 备份后修改数据

    ![/图片16](./16.png)

    ![/图片17](./17.png)

16. 删除数据库文件，模拟数据库文件损坏

    ![/图片18](./18.png)

17. 删除数据库文件后修改数据

    ![/图片19](./19.png)

    ![/图片20](./20.png)

18. 数据库完全恢复

    1. 重启损坏的数据库到mount状态

       ![/图片21](./21.png)

    2. 开始恢复数据库

       ![/图片22](./22.png)

       ![/图片23](./23.png)

    3. 查询数据是否恢复

       ![/图片24](./24.png)

19. 设计容灾方法，使用两台主机，通过DataGuard实现数据库整体的异地备份

    1. 备库

       ![/图片25](./25.png)

    2. 删除原有数据库

       ![/图片26](./26.png)

    3. 启动到nomount7

       ![/图片27](./27.png)

    4. 主库

       ![/图片28](./28.png)

       ![/图片29](./29.png)

       ![/图片30](./30.png)

    5. 主库环境开启强制归档

       ![/图片31](./31.png)

       ![/图片32](./32.png)

    6. 编辑主库及备份的/home/oracle/app/oracle/product/12.1.0/dbhome_1/network/admin/tnsnames.ora文件

       ![/图片33](./33.png)

    7. 生成/home/oracle/app/oracle/product/12.1.0/dbhome_1/dbs/initorcl.ora

       ![/图片34](./34.png)

    8. 将主库的参数文件，密码文件拷贝到备库

       ![/图片35](./35.png)

    9. 在备库上更改参数文件

       ![/图片36](./36.png)

    10. 在备库增加静态监听

        ![/图片37](./37.png)

        ![/图片38](./38.png)

    11. 重新启动，备库开启实时应用模式

        ![/图片39](./39.png)
